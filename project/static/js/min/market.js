'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){if(a==Array.prototype||a==Object.prototype)return a;a[c]=d.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<a.length;++c){var d=a[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,c){var d=$jscomp.propertyToPolyfillSymbol[c];if(null==d)return a[c];d=a[d];return void 0!==d?d:a[c]};$jscomp.polyfill=function(a,c,d,e){c&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,c,d,e):$jscomp.polyfillUnisolated(a,c,d,e))};
$jscomp.polyfillUnisolated=function(a,c,d,e){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var b=a[e];if(!(b in d))return;d=d[b]}a=a[a.length-1];e=d[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:c})};
$jscomp.polyfillIsolated=function(a,c,d,e){var b=a.split(".");a=1===b.length;e=b[0];e=!a&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<b.length-1;f++){var g=b[f];if(!(g in e))return;e=e[g]}b=b[b.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?e[b]:null;c=c(d);null!=c&&(a?$jscomp.defineProperty($jscomp.polyfills,b,{configurable:!0,writable:!0,value:c}):c!==d&&(void 0===$jscomp.propertyToPolyfillSymbol[b]&&(d=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[b]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(b):$jscomp.POLYFILL_PREFIX+d+"$"+b),$jscomp.defineProperty(e,$jscomp.propertyToPolyfillSymbol[b],{configurable:!0,writable:!0,value:c})))};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},c={};try{return c.__proto__=a,c.a}catch(d){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,c){a.__proto__=c;if(a.__proto__!==c)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};
$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,c){this.nextAddress=c;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,c){a=$jscomp.makeIterator(a);var d=a.next();$jscomp.generator.ensureIteratorResultIsObject_(d);if(d.done)this.yieldResult=d.value,this.nextAddress=c;else return this.yieldAllIterator_=a,this.yield(d.value,c)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,c){this.catchAddress_=a;void 0!=c&&(this.finallyAddress_=c)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,c){this.nextAddress=a;this.catchAddress_=c||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,c,d){d?this.finallyContexts_[d]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=c||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,c){c=this.finallyContexts_.splice(c||0)[0];if(c=this.abruptCompletion_=this.abruptCompletion_||c){if(c.isException)return this.jumpToErrorHandler_();void 0!=c.jumpTo&&this.finallyAddress_<c.jumpTo?(this.nextAddress=c.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var c in a)this.properties_.push(c);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var c=this.context_.yieldAllIterator_;if(c)return this.yieldAllStep_("return"in c?c["return"]:function(d){return{value:d,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,c,d){try{var e=a.call(this.context_.yieldAllIterator_,c);$jscomp.generator.ensureIteratorResultIsObject_(e);if(!e.done)return this.context_.stop_(),e;var b=e.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;d.call(this.context_,b);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(c){this.context_.yieldResult=void 0,this.context_.throw_(c)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(c){return a.next_(c)};this.throw=function(c){return a.throw_(c)};this.return=function(c){return a.return_(c)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,c){c=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(c));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(c,a.prototype);return c};
$jscomp.asyncExecutePromiseGenerator=function(a){function c(e){return a.next(e)}function d(e){return a.throw(e)}return new Promise(function(e,b){function f(g){g.done?e(g.value):Promise.resolve(g.value).then(c,d).then(f,b)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
var csrftoken=$("meta[name=csrf-token]").attr("content");window.csrfprotect=a=>{a["X-CSRFToken"]=csrftoken;return a};
$(document).ready(function(){$(".dropdown-trigger").dropdown({alignment:"right",constrainWidth:!1,coverTrigger:!1});$(".tooltipped").tooltip();M.updateTextFields();dayjs.extend(window.dayjs_plugin_utc);dayjs.extend(window.dayjs_plugin_relativeTime);window.Book=class{constructor(b){this.googleId=null==b?void 0:b.id;let f;this.title=null==b?void 0:null==(f=b.volumeInfo)?void 0:f.title;let g,k,h;this.isbn=null==b?void 0:null==(g=b.volumeInfo)?void 0:null==(k=g.industryIdentifiers)?void 0:null==(h=k.find(I=>
"ISBN_13"==I.type))?void 0:h.identifier;let l;this.authors=null==b?void 0:null==(l=b.volumeInfo)?void 0:l.authors;let m;this.language=null==b?void 0:null==(m=b.volumeInfo)?void 0:m.language;let n;this.publisher=null==b?void 0:null==(n=b.volumeInfo)?void 0:n.publisher;let p;this.publishedDate=null==b?void 0:null==(p=b.volumeInfo)?void 0:p.publishedDate;let q;this.pageCount=null==b?void 0:null==(q=b.volumeInfo)?void 0:q.pageCount;let r,t;this.height=null==b?void 0:null==(r=b.volumeInfo)?void 0:null==
(t=r.dimensions)?void 0:t.height;let u,v;this.width=null==b?void 0:null==(u=b.volumeInfo)?void 0:null==(v=u.dimensions)?void 0:v.width;let w,x;this.thickness=null==b?void 0:null==(w=b.volumeInfo)?void 0:null==(x=w.dimensions)?void 0:x.thickness;let y;this.imagelinks=null==b?void 0:null==(y=b.volumeInfo)?void 0:y.imageLinks;let z,A;this.thumbSmall=null==(z=this.imagelinks)?void 0:null==(A=z.smallThumbnail)?void 0:A.replace("http","https");let B,C,D,E,F,G;this.thumbLarge=(null==(B=this.imagelinks)?
0:B.extraLarge)?this.imagelinks.extraLarge:(null==(C=this.imagelinks)?0:C.large)?this.imagelinks.large:(null==(D=this.imagelinks)?0:D.medium)?this.imagelinks.medium:(null==(E=this.imagelinks)?0:E.small)?this.imagelinks.small:(null==(F=this.imagelinks)?0:F.thumbnail)?this.imagelinks.thumbnail:null==(G=this.imagelinks)?void 0:G.smallThumbnail;let H;this.thumbLarge=null==(H=this.thumbLarge)?void 0:H.replace("http","https");this.strings={};this.strings.title=this.title||"Unknown";this.strings.isbn=this.isbn||
"Unknown";this.strings.authors=this.authors?this.authors.join(this.language&&this.language.includes("en")?", ":"„ÄÅ"):"Unknown";this.strings.plurality=this.authors?1<this.authors.length?"s":"":"";this.strings.publisher=this.publisher||"Unknown";this.strings.publishedDate=this.publishedDate||"Unknown";this.strings.pageCount=this.pageCount||"Unknown";this.strings.dimensions=this.height&&this.width&&this.thickness?`Height - ${this.height}, Width - ${this.width}, Thickness - ${this.thickness}`:"Unknown";
this.strings.thumbSmall=this.thumbSmall?this.thumbSmall:this.thumbLarge?this.thumbLarge:"https://books.google.com.hk/googlebooks/images/no_cover_thumb.gif"}};window.Listing=class{constructor(b){for(const f in b)this[f]=b[f];this.strings={};b=dayjs(1E3*this.created).local();this.strings.created=`${b.format("DD/MM/YYYY HH:mm:ss")} (${b.fromNow()})`;this.strings.open=this.open?"Public":"Hidden";this.strings.openIcon=this.open?"visibility":"visibility_off";switch(this.condition){case 0:this.strings.condition=
"Poor";this.strings.conditionDescription="Significant wear, possibly with a broken spine, loose joints or missing pages";this.strings.conditionClass="condition-poor";break;case 1:this.strings.condition="Fair";this.strings.conditionDescription="Some wear, possibly with folded pages, scratches or dents";this.strings.conditionClass="condition-fair";break;case 2:this.strings.condition="Good";this.strings.conditionDescription="Minor wear, but will still show signs of previous ownership";this.strings.conditionClass=
"condition-good";break;case 3:this.strings.condition="Fine",this.strings.conditionDescription="Very minor defects and faults, like brand new",this.strings.conditionClass="condition-fine"}switch(this.notes){case 0:this.strings.notes="None";break;case 1:this.strings.notes="Some";break;case 2:this.strings.notes="Comprehensive"}this.strings.price=`HKD ${this.price}`;this.strings.remarks=this.remarks||"---"}};class a extends Error{constructor(b){super(b)}}class c extends Error{constructor(b){super(b);
this.message=`${b.status}: ${b.statusText}`}}class d extends Error{constructor(b){super(b);this.message=`${b.code}: ${b.message}`}}class e extends Error{constructor(){super();this.message="No results found."}}window.NetworkError=c;window.APIError=d;window.NoGoogleBooksResultsError=e;window.ControlledError=a;window.toast=function(b){const f=b.description||"An unknown error occurred",g=`${b.headerPrefix} `||"";let k,h;switch(b.code||3){case 3:k=`${g}Error`;h="toastError";break;case 2:k=`${g}Warning`;
h="toastWarning";break;case 1:k=`${g}Success`;h="toastSuccess";break;case 0:k=`${g}Information`,h="toastInformation"}M.toast({unsafeHTML:`<div>
                <div class="font-size-16 text-bold mb-2">
                    ${k}
                </div>
                <div class="font-size-14 line-height-24">
                    ${f}
                </div>
            </div>`,classes:`toastGeneral ${h} roundBox`})};window.toastError=function(b){b instanceof c?toast({description:b.message,headerPrefix:"Network",code:3}):b instanceof d&&toast({description:b.message,headerPrefix:"Server",code:3});console.error(b)};window.removeShimmer=function(b){$(b).removeClass("shimmerBG")};window.removeMinPicHeight=function(b){$(b).removeClass("minPicHeight")};768>$(window).width()&&toast({description:'Elements may appear glitched on mobile. Please use a computer, or try rotating your device into the horizontal orientation. View <a href="/help#master">help</a> for more details.',
headerPrefix:"Incompatibility",code:2})});
$(document).ready(function(){function a(){$('[data-element="progress"]').removeClass("hide");$('[data-element="help"]').html("Loading...");$('[data-element="market_results"]').empty()}function c(e){e=void 0===e?[]:e;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){a();$('[data-button="view_details"]').off();yield fetch("/api/v1/market/aggregate",{method:"POST",mode:"cors",headers:csrfprotect({"Content-Type":"application/json"}),body:JSON.stringify({bookids:e})}).then(b=>{if(b.ok)return b.json();
throw new NetworkError(b);}).then(b=>{if("success"!=b.status)throw new APIError(b);if(0==b.data.length)throw new NoGoogleBooksResultsError;return b.data}).then(b=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){return Promise.all(b.map(f=>{({bookid:f}=f);return fetch(`https://www.googleapis.com/books/v1/volumes/${f}`,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}})})).then(f=>Promise.all(f.map(g=>{if(!g.ok)throw new NetworkError(g);return g.json()}))).then(f=>Promise.all(f.map(g=>
{if("error"in g)throw new NoGoogleBooksResultsError;return g}))).then(f=>{let g=$('[data-element="market_results"]');for(let h=0;h<f.length;h++){var k=new Book(f[h]);k=$(`<div class="row mx-0 mb-8 p-8 roundBox book" data-bookid="${b[h].bookid}">
                        <div class="col s2 mx-0 p-0 minPicHeight shimmerBG">
                            <img class="google-book-image roundBox" src="${k.strings.thumbSmall}" onload="removeShimmer(this.parentElement);removeMinPicHeight(this.parentElement)" data-field="thumb">
                        </div>
                        <div class="col s10">
                            <div class="row mt-0 mb-2">
                                <div class="col font-size-24 text-bold">${k.strings.title}</div>
                            </div>
                            <div class="row mt-0 mb-2 align-items-end">
                                <div class="col s6">
                                    <div class="row my-0">
                                        <div class="col font-size-14 text-muted">Author${k.strings.plurality}</div>
                                    </div>
                                    <div class="row my-0">
                                        <div class="col font-size-16">${k.strings.authors}</div>
                                    </div>
                                    <div class="row my-0">
                                        <div class="col font-size-14 text-muted">Publisher</div>
                                    </div>
                                    <div class="row my-0">
                                        <div class="col font-size-16">${k.strings.publisher}</div>
                                    </div>
                                    <div class="row my-0">
                                        <div class="col font-size-14 text-muted">ISBN</div>
                                    </div>
                                    <div class="row my-0">
                                        <div class="col font-size-16">${k.strings.isbn}</div>
                                    </div>
                                </div>
                                <div class="col s6">
                                    <div class="row my-0 justify-content-end">
                                        <div class="col font-size-16">${b[h].count} offer${1<b[h].count?"s":""}</div>
                                    </div>
                                    <div class="row my-0 justify-content-end">
                                        <div class="col font-size-20">From HKD${b[h].minPrice}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row my-0 justify-content-end">
                                <div class="col">
                                    <a class="btn px-8 roundBox btn-transparent btn-transparent-primary" data-button="view_details">
                                        <i class="material-icons left">list</i>
                                        View Details
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>`);g.append(k)}$('[data-button="view_details"]').click(h=>{h=$(h.target).closest("[data-bookid]").attr("data-bookid");window.location.href=`/market/${h}`});$('[data-element="help"]').empty()}).catch(f=>{throw f;})})).catch(b=>{b instanceof NoGoogleBooksResultsError?$('[data-element="help"]').html('<div>No results found. Please check your inputs.</div><div>If you are searching by ISBN, add an <span class="text-bold">isbn:</span> prefix.</div><div>For more information about prefixes, check the <a href="/help#query">query</a> section of help.</div>'):
b instanceof NetworkError?$('[data-element="help"]').html("An error occured when retrieving data. Please check your connection or try again."):console.error(b)}).finally(()=>{$('[data-element="progress"]').addClass("hide")})})}function d(e){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){e?(a(),fetch(`https://www.googleapis.com/books/v1/volumes?q=${e}&orderBy=relevance&maxResults=40&projection=lite`,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then(b=>{if(!b.ok)throw new NetworkError(b);
return b.json()}).then(b=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(0==b.totalItems)throw new NoGoogleBooksResultsError;yield c(b.items.map(f=>f.id))})).catch(b=>{b instanceof NoGoogleBooksResultsError?$('[data-element="help"]').html('<div>No results found. Please check your inputs.</div><div>If you are searching by ISBN, add an <span class="text-bold">isbn:</span> prefix.</div><div>For more information about prefixes, check the <a href="/help#query">query</a> section of help.</div>'):
b instanceof NetworkError?$('[data-element="help"]').html("An error occured when retrieving data. Please check your connection or try again."):console.error(b)}).finally(()=>{$('[data-element="progress"]').addClass("hide")})):yield c()})}$('[data-element="help"]').html("Loading...");$('[data-field="google_book_input"]').keyup(function(e,b){let f=0;return function(...g){clearTimeout(f);f=setTimeout(e.bind(this,...g),b||0)}}(function(e){13!=e.which&&d(e.target.value)},500)).keypress(function(e){13==
e.which&&(e.target.blur(),d(e.target.value))});c()});
