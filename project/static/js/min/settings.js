'use strict';var csrftoken=$("meta[name=csrf-token]").attr("content");window.csrfprotect=d=>{d["X-CSRFToken"]=csrftoken;return d};
$(document).ready(function(){$(".dropdown-trigger").dropdown({alignment:"right",constrainWidth:!1,coverTrigger:!1});$(".tooltipped").tooltip();M.updateTextFields();dayjs.extend(window.dayjs_plugin_utc);dayjs.extend(window.dayjs_plugin_relativeTime);window.Book=class{constructor(b){this.googleId=b?.id;this.title=b?.volumeInfo?.title;this.isbn=b?.volumeInfo?.industryIdentifiers?.find(e=>"ISBN_13"==e.type)?.identifier;this.authors=b?.volumeInfo?.authors;this.language=b?.volumeInfo?.language;this.publisher=
b?.volumeInfo?.publisher;this.publishedDate=b?.volumeInfo?.publishedDate;this.pageCount=b?.volumeInfo?.pageCount;this.height=b?.volumeInfo?.dimensions?.height;this.width=b?.volumeInfo?.dimensions?.width;this.thickness=b?.volumeInfo?.dimensions?.thickness;this.imagelinks=b?.volumeInfo?.imageLinks;this.thumbSmall=this.imagelinks?.smallThumbnail;this.thumbLarge=this.imagelinks?.extraLarge?this.imagelinks.extraLarge:this.imagelinks?.large?this.imagelinks.large:this.imagelinks?.medium?this.imagelinks.medium:
this.imagelinks?.small?this.imagelinks.small:this.imagelinks?.thumbnail?this.imagelinks.thumbnail:this.imagelinks?.smallThumbnail;this.strings={};this.strings.title=this.title||"Unknown";this.strings.isbn=this.isbn||"Unknown";this.strings.authors=this.authors?this.authors.join(this.language&&this.language.includes("en")?", ":"„ÄÅ"):"Unknown";this.strings.plurality=this.authors?1<this.authors.length?"s":"":"";this.strings.publisher=this.publisher||"Unknown";this.strings.publishedDate=this.publishedDate||
"Unknown";this.strings.pageCount=this.pageCount||"Unknown";this.strings.dimensions=this.height&&this.width&&this.thickness?`Height - ${this.height}, Width - ${this.width}, Thickness - ${this.thickness}`:"Unknown";this.strings.thumbSmall=this.thumbSmall?this.thumbSmall:this.thumbLarge?this.thumbLarge:"https://books.google.com.hk/googlebooks/images/no_cover_thumb.gif"}};window.Listing=class{constructor(b){for(const e in b)this[e]=b[e];this.strings={};b=dayjs(1E3*this.created).local();this.strings.created=
`${b.format("DD/MM/YYYY HH:mm:ss")} (${b.fromNow()})`;this.strings.open=this.open?"Public":"Hidden";this.strings.openIcon=this.open?"visibility":"visibility_off";switch(this.condition){case 0:this.strings.condition="Poor";this.strings.conditionDescription="Significant wear, possibly with a broken spine, loose joints or missing pages";this.strings.conditionClass="condition-poor";break;case 1:this.strings.condition="Fair";this.strings.conditionDescription="Some wear, possibly with folded pages, scratches or dents";
this.strings.conditionClass="condition-fair";break;case 2:this.strings.condition="Good";this.strings.conditionDescription="Minor wear, but will still show signs of previous ownership";this.strings.conditionClass="condition-good";break;case 3:this.strings.condition="Fine",this.strings.conditionDescription="Very minor defects and faults, like brand new",this.strings.conditionClass="condition-fine"}switch(this.notes){case 0:this.strings.notes="None";break;case 1:this.strings.notes="Some";break;case 2:this.strings.notes=
"Comprehensive"}this.strings.price=`HKD ${this.price}`;this.strings.remarks=this.remarks||"---"}};class d extends Error{constructor(b){super(b)}}class a extends Error{constructor(b){super(b);this.message=`${b.status}: ${b.statusText}`}}class c extends Error{constructor(b){super(b);this.message=`${b.code}: ${b.message}`}}class f extends Error{constructor(){super();this.message="No results found."}}window.NetworkError=a;window.APIError=c;window.NoGoogleBooksResultsError=f;window.ControlledError=d;window.toast=
function(b){const e=b.description||"An unknown error occurred",k=`${b.headerPrefix} `||"";let g,h;switch(b.code||3){case 3:g=`${k}Error`;h="toastError";break;case 2:g=`${k}Warning`;h="toastWarning";break;case 1:g=`${k}Success`;h="toastSuccess";break;case 0:g=`${k}Information`,h="toastInformation"}M.toast({unsafeHTML:`<div>
                <div class="font-size-16 text-bold mb-2">
                    ${g}
                </div>
                <div class="font-size-14 line-height-24">
                    ${e}
                </div>
            </div>`,classes:`toastGeneral ${h} roundBox`})};window.toastError=function(b){b instanceof a?toast({description:b.message,headerPrefix:"Network",code:3}):b instanceof c&&toast({description:b.message,headerPrefix:"Server",code:3});console.error(b)};window.removeShimmer=function(b){$(b).removeClass("shimmerBG")};window.removeMinPicHeight=function(b){$(b).removeClass("minPicHeight")};768>$(window).width()&&toast({description:'Elements will appear glitched on mobile. Please use a computer or enable the "request a desktop site" option. View <a href="/help#master">help</a> for more details.',
headerPrefix:"Incompatibility",code:2})});
$(document).ready(function(){$('[data-editfield="customContactInfo_text"]').characterCounter();fetch("/api/v1/user/detail",{method:"GET",mode:"cors",headers:csrfprotect({"Content-Type":"application/json"})}).then(a=>{if(a.ok)return a.json();throw new NetworkError(a);}).then(a=>{if("success"!=a.status)throw new APIError(a);return a.data}).then(a=>{a=new d(a);a.populate();a.bindEditActions();a.bindSaveActions()}).catch(a=>{toastError(a)});class d{constructor(a){this.data=a}remove_loader(a){$(`[data-field="${a}"]`).addClass("hide").removeClass("shimmerBG")}unhide_container(a){$(`[data-field="${a}"]`).removeClass("hide")}hide_container(a){$(`[data-field="${a}"]`).addClass("hide")}bindEditAction(a){$(`[data-edit="${a}"]`).click(()=>
{$(`[data-section="${a}_display"]`).addClass("hide");$(`[data-edit="${a}"]`).addClass("hide");$(`[data-section="${a}_editor"]`).removeClass("hide");$(`[data-save="${a}"]`).removeClass("hide")})}update_profile(){$('[data-field="profilePic"]').attr("src",`${this.data.profilePic}=s172-c`);$('[data-field="name"]').html(this.data.name).removeClass("shimmerBG");this.data.cky?$('[data-field="cky"]').attr("data-tooltip","This user is a verified CKY student.").html("verified").addClass("verified"):$('[data-field="cky"]').attr("data-tooltip",
"This user may not be a CKY student.").html("warning").addClass("not-verified")}update_emailnotifications_edit(){$('[data-editfield="email_notifications"]').prop("checked",this.data.emailnotifications)}update_emailnotifications(){this.data.emailnotifications?$('[data-field="email_notifications"]').removeClass("not-negotiable").addClass("negotiable").html("check"):$('[data-field="email_notifications"]').removeClass("negotiable").addClass("not-negotiable").html("close");this.update_emailnotifications_edit()}update_payment_edit(){const a=
"cash octopus payme tapngo bankTransfer eCheque alipay wechatPay".split(" ");for(let c of a)this.data[c]?$(`[data-editfield="${c}"]`).prop("checked",!0):$(`[data-editfield="${c}"]`).prop("checked",!1)}update_payment(){const a="cash octopus payme tapngo bankTransfer eCheque alipay wechatPay".split(" ");let c=!1;for(let f of a)this.data[f]?(c=!0,$(`[data-field="${f}"]`).attr("src",`/static/img/payment/${f}.png`)):$(`[data-field="${f}"]`).attr("src","");c?$('[data-field="payment_information_loader"]').html("").addClass("hide"):
$('[data-field="payment_information_loader"]').html("Unset").removeClass("hide");this.update_payment_edit()}update_sellerDeliveryMethods_edit(){$('[data-editfield="inSchoolExchange"]').prop("checked",this.data.inSchoolExchange);$('[data-editfield="meetup"]').prop("checked",this.data.meetup);$('[data-editfield="delivery"]').prop("checked",this.data.delivery)}update_sellerDeliveryMethods(){this.data.inSchoolExchange?$('[data-field="inSchoolExchange"]').removeClass("hide"):$('[data-field="inSchoolExchange"]').addClass("hide");
this.data.meetup?$('[data-field="meetup"]').removeClass("hide"):$('[data-field="meetup"]').addClass("hide");this.data.delivery?$('[data-field="delivery"]').removeClass("hide"):$('[data-field="delivery"]').addClass("hide");this.data.inSchoolExchange||this.data.meetup||this.data.delivery?$('[data-field="seller_delivery_methods_loader"]').html("").addClass("hide"):$('[data-field="seller_delivery_methods_loader"]').html("Unset").removeClass("hide");this.update_sellerDeliveryMethods_edit()}update_sellerNegotiable_edit(){$('[data-editfield="negotiable"]').prop("checked",
this.data.negotiable)}update_sellerNegotiable(){this.data.negotiable?$('[data-field="negotiable"]').removeClass("not-negotiable").addClass("negotiable").html("check"):$('[data-field="negotiable"]').removeClass("negotiable").addClass("not-negotiable").html("close");this.update_sellerNegotiable_edit()}update_publicity_edit(){$('[data-editfield="public"]').prop("checked",this.data.public)}update_publicity(){this.data.public?($('[data-field="public"]').html("Public"),$('[data-field="public_icon"]').html("public").attr("data-tooltip",
"Everyone can see your information.")):($('[data-field="public"]').html("Private"),$('[data-field="public_icon"]').html("lock").attr("data-tooltip","Only you can see the information."));this.unhide_container("public_container");this.update_publicity_edit()}update_email(){this.data.email?($('[data-field="email"]').html(this.data.email),this.unhide_container("email_container")):this.hide_container("email_container")}update_discord_edit_text(){$('[data-editfield="discord_text"]').val(this.data.discord);
M.updateTextFields();$('[data-editfield="discord"]').is(":checked")?$('[data-editfieldgroup="discord"]').removeClass("hide"):$('[data-editfieldgroup="discord"]').addClass("hide")}update_discord_edit(){$('[data-editfield="discord"]').prop("checked",!!this.data.discord).click(()=>{this.update_discord_edit_text()});this.update_discord_edit_text()}update_discord(){this.data.discord?($('[data-field="discord_icon"]').attr("src","/static/img/contact/discord.png"),$('[data-field="discord"]').html(this.data.discord),
this.unhide_container("discord_container")):this.hide_container("discord_container");this.update_discord_edit()}update_instagram_edit_text(){$('[data-editfield="instagram_text"]').val(this.data.instagram);M.updateTextFields();$('[data-editfield="instagram"]').is(":checked")?$('[data-editfieldgroup="instagram"]').removeClass("hide"):$('[data-editfieldgroup="instagram"]').addClass("hide")}update_instagram_edit(){$('[data-editfield="instagram"]').prop("checked",!!this.data.instagram).click(()=>{this.update_instagram_edit_text()});
this.update_instagram_edit_text()}update_instagram(){this.data.instagram?($('[data-field="instagram_icon"]').attr("src","/static/img/contact/instagram.png"),$('[data-field="instagram"]').html(this.data.instagram),this.unhide_container("instagram_container")):this.hide_container("instagram_container");this.update_instagram_edit()}update_phone_edit_text(){$('[data-editfield="phone_text"]').val(this.data.phone);M.updateTextFields();$('[data-editfield="phone"]').is(":checked")?$('[data-editfieldgroup="phone"]').removeClass("hide"):
$('[data-editfieldgroup="phone"]').addClass("hide")}update_phone_edit(){$('[data-editfield="phone"]').prop("checked",!!this.data.phone).click(()=>{this.update_phone_edit_text()});$('[data-editfield="whatsapp"]').prop("checked",this.data.whatsapp);$('[data-editfield="signal"]').prop("checked",this.data.signal);$('[data-editfield="telegram"]').prop("checked",this.data.telegram);this.update_phone_edit_text()}update_phone(){this.data.phone?($('[data-field="phone"]').html(this.data.phone),this.data.whatsapp&&
$('[data-field="whatsapp"]').attr("src","/static/img/contact/whatsapp.png"),this.data.signal&&$('[data-field="signal"]').attr("src","/static/img/contact/signal.png"),this.data.telegram&&$('[data-field="telegram"]').attr("src","/static/img/contact/telegram.png"),this.unhide_container("phone_container")):this.hide_container("phone_container");this.update_phone_edit()}update_customContactInfo_edit_text(){$('[data-editfield="customContactInfo_text"]').val(this.data.customContactInfo);M.textareaAutoResize($('[data-editfield="customContactInfo_text"]'));
$('[data-editfield="customContactInfo"]').is(":checked")?$('[data-editfieldgroup="customContactInfo"]').removeClass("hide"):$('[data-editfieldgroup="customContactInfo"]').addClass("hide")}update_customContactInfo_edit(){$('[data-editfield="customContactInfo"]').prop("checked",!!this.data.customContactInfo).click(()=>{this.update_customContactInfo_edit_text()});this.update_customContactInfo_edit_text()}update_customContactInfo(){this.data.customContactInfo?($('[data-field="customContactInfo"]').html(this.data.customContactInfo),
this.unhide_container("customContactInfo_container")):this.hide_container("customContactInfo_container");this.update_customContactInfo_edit()}populate(){this.update_profile();this.remove_loader("email_notifications_loader");this.update_emailnotifications();this.remove_loader("payment_information_loader");this.update_payment();this.remove_loader("seller_delivery_methods_loader");this.update_sellerDeliveryMethods();this.remove_loader("seller_negotiable_loader");this.update_sellerNegotiable();this.remove_loader("contact_information_loader");
this.update_publicity();this.update_email();this.update_discord();this.update_instagram();this.update_phone();this.update_customContactInfo()}bindEditActions(){this.bindEditAction("email_notifications");this.bindEditAction("payment_information");this.bindEditAction("seller_delivery_methods");this.bindEditAction("seller_negotiable");this.bindEditAction("contact_information")}async save_settings(a){return await fetch("api/v1/user/update",{method:"PATCH",mode:"cors",headers:csrfprotect({"Content-Type":"application/json"}),
body:JSON.stringify(a)}).then(c=>{if(!c.ok)throw new NetworkError;return c.json()}).then(c=>{if("success"==c.status)return toast({description:c.message,headerPrefix:"",code:1}),c.data;throw new APIError(c);}).catch(c=>{toastError(c);return null})}save_visual(a){$(`[data-section="${a}_editor"]`).addClass("hide");$(`[data-save="${a}"]`).addClass("hide");$(`[data-section="${a}_display"]`).removeClass("hide");$(`[data-edit="${a}"]`).removeClass("hide")}getInput_emailnotifications(){let a={};a.emailnotifications=
$('[data-editfield="email_notifications"]').is(":checked");return a}bindSaveAction_emailnotifications(){$('[data-save="email_notifications"]').click(()=>{const a=this.getInput_emailnotifications();this.save_settings(a).then(c=>{c&&(this.data=Object.assign(this.data,c),this.update_emailnotifications(),this.save_visual("email_notifications"))})})}getInput_payment(){let a={};a.cash=$('[data-editfield="cash"]').is(":checked");a.octopus=$('[data-editfield="octopus"]').is(":checked");a.payme=$('[data-editfield="payme"]').is(":checked");
a.tapngo=$('[data-editfield="tapngo"]').is(":checked");a.bankTransfer=$('[data-editfield="bankTransfer"]').is(":checked");a.wechatPay=$('[data-editfield="wechatPay"]').is(":checked");a.alipay=$('[data-editfield="alipay"]').is(":checked");a.eCheque=$('[data-editfield="eCheque"]').is(":checked");return a}bindSaveAction_payment(){$('[data-save="payment_information"]').click(()=>{const a=this.getInput_payment();this.save_settings(a).then(c=>{c&&(this.data=Object.assign(this.data,c),this.update_payment(),
this.save_visual("payment_information"))})})}getInput_sellerDeliveryMethods(){let a={};a.inSchoolExchange=$('[data-editfield="inSchoolExchange"]').is(":checked");a.meetup=$('[data-editfield="meetup"]').is(":checked");a.delivery=$('[data-editfield="delivery"]').is(":checked");return a}bindSaveAction_sellerDeliveryMethods(){$('[data-save="seller_delivery_methods"]').click(()=>{const a=this.getInput_sellerDeliveryMethods();this.save_settings(a).then(c=>{c&&(this.data=Object.assign(this.data,c),this.update_sellerDeliveryMethods(),
this.save_visual("seller_delivery_methods"))})})}getInput_sellerNegotiable(){let a={};a.negotiable=$('[data-editfield="negotiable"]').is(":checked");return a}bindSaveAction_sellerNegotiable(){$('[data-save="seller_negotiable"]').click(()=>{const a=this.getInput_sellerNegotiable();this.save_settings(a).then(c=>{c&&(this.data=Object.assign(this.data,c),this.update_sellerNegotiable(),this.save_visual("seller_negotiable"))})})}getInput_contactInformation(){let a={};a.public=$('[data-editfield="public"]').is(":checked");
a.discord=$('[data-editfield="discord"]').is(":checked")?$('[data-editfield="discord_text"]').val():"";a.instagram=$('[data-editfield="instagram"]').is(":checked")?$('[data-editfield="instagram_text"]').val():"";a.phone=$('[data-editfield="phone"]').is(":checked")?$('[data-editfield="phone_text"]').val():"";a.whatsapp=$('[data-editfield="whatsapp"]').is(":checked");a.signal=$('[data-editfield="signal"]').is(":checked");a.telegram=$('[data-editfield="telegram"]').is(":checked");a.customContactInfo=
$('[data-editfield="customContactInfo"]').is(":checked")?$('[data-editfield="customContactInfo_text"]').val():"";return a}bindSaveAction_contactInformation(){$('[data-save="contact_information"]').click(()=>{const a=this.getInput_contactInformation();this.save_settings(a).then(c=>{c&&(this.data=Object.assign(this.data,c),this.update_publicity(),this.update_discord(),this.update_instagram(),this.update_phone(),this.update_customContactInfo(),this.save_visual("contact_information"))})})}bindSaveActions(){this.bindSaveAction_emailnotifications();
this.bindSaveAction_payment();this.bindSaveAction_sellerDeliveryMethods();this.bindSaveAction_sellerNegotiable();this.bindSaveAction_contactInformation()}}});
